{"title":"【博客园富文本 to Markdown】【epub.js】开源中间件epub.js的使用及其中文api","content":"epub是最流行的电子书规范之一，网络上对于Java Web有不少合适的方法来解析和呈现，但是关于epub.js的介绍比较少（尽管github上已经2K星了），更多的是概念性的内容，如：  \n+ epub.js是支持跨多个设备的，在浏览器端渲染EPUB文件的JavaScript库，提供通用的电子书功能界面（如渲染、持久和分页）不需要开发专用的应用程序或插件。  \n\n具体用法因人而异，在此我介绍结合React使用的案例：  \n\nepub.js中间件封装了解析epub文件的过程，ePubReader以控制器方式封装了页面动作响应。  epub.js的[官方文档](https://github.com/futurepress/epub.js/blob/master/documentation/README.md)\n\n2017.11.22更新：  \n如果使用ePubReader解析图书，还想应用epub.js的API，需要以这种形式：  \n```\nvar reader = ePubReader(\"./book/\"+newsid);//获得解析图书的实例\nreader.book.on(\"book:ready\",function(){alert('1')});//拿到book变量，然后就能使用epub.js的API了  \n```  \n原因是在ePubReader的源码中：  \nePubReader解析并没有像epub.js一样返回一个book对象，而是返回了reader对象，这个reader对象在上图蓝色标记处创建了自己的book对象，这个book对象又来自epub.js的Book对象，所以reader.book就是epub.js中的book了，拿到book以后其他用法和epub.js都一样了。\n\n## 方法：  \n+ ePub(bookPath, options)   创建EPUB图书实例：    \nbookPath可选参数，指定epub文件路径，可以是网络资源，也可以是本地资源。  \nvar Book = ePub(\"url/to/book/\"); // With default options  \nvar Book = ePub({ restore: true });   \nBook.open(\"url/to/book/\"); // Books can be opened later   \nOptions  可选参数，配置解析参数  \n{  \n  bookPath : null,  \n  version: 1, // Changing will cause stored Book information to be reloaded  \n  restore: false, // Skips parsing epub contents, loading from localstorage instead   \n  storage: false, // true (auto) or false (none) | override: 'ram', 'websqldatabase', 'indexeddb', 'filesystem'  \n  spreads: true, // Displays two columns  \n  fixedLayout : false, //-- Will turn off pagination  \n  styles : {}, // Styles to be applied to epub  \n  width : false, //width和height可以设置图书内容的宽和高，默认值是不设置，此时会填满父窗口。  \n  height: false,     \n}  \n\n## 解析图书的更多方法：\n+ Book.open(bookPath) 打开指定路径的图书，和构造函数的作用类似，只是将配置和解析的过程分开  \nvar Book = ePub({ restore: true });   \nBook.open(\"url/to/book/\"); // Books can be opened later   \n也可以带扩展名：  \nBook.open(\"url/to/book.epub\");  \n\n+ Book.renderTo(element) 将解析好的图书追加到某个HTML结点并渲染，此时epub图书内容在HTML中呈现。（使用的是iframe标签）  \nvar Book = ePub(\"url/to/book/\", { restore: true });  \nvar $el = document.getElementById(\"div-id\");  \nBook.renderTo($el);  \n参数也可以是字符串表示：  \nvar Book = ePub(\"url/to/book/\");  \nBook.renderTo(\"div-id\");  \n\n+ Book.nextPage()    \nBook.prevPage()    \n在阅读页面中的翻页控制函数，添加到按钮事件函数：\n```\n         <div onclick=\"Book.prevPage();\">‹</div>\n         <div onclick=\"Book.nextPage();\">›</div>\n         必须在渲染之后，才会响应翻页。  \n```  \n+ Book.displayChapter(chap, end)   显示指定章节：  \n加载指定的章节到页面上，加载的是这一章的第一页：  \nBook.displayChapter('/6/4[chap01ref]!/4[body01]/10');      \n第二个参数设置为true，将加载这一章的最后一页：  \nBook.displayChapter(3, true);  \n\n+ Book.goto(url)跳转到指定章节：  \n加载指定的章节（需要有pageMap）    \nvar skip = Book.goto(\"chapter_001.xhtml\");  \nskip.then(function(){  \n     console.log(\"On Chapter 1\");  \n})  \n通常用来显示一些带有指定章节链接的表格  \n\n+ Book.setStyle(style, val, prefixed)设置图书内容的样式：  \nBook.setStyle(\"font-size\", \"1.2em\");  \n+ Book.removeStyle(style)移除设置的样式。\n+ Book.destroy()删除iframe和事件函数。\n## Promises\n+ Book.getMetadata()在回调函数中获取meta数据：   \n Book.getMetadata().then(function(meta){  \n    document.title = meta.bookTitle+\" – \"+meta.creator;  \n});  \n返回一个对象：  \n{  \n  \"bookTitle\": \"The title of the book\",  \n  \"creator\": \"Book Author\",  \n  \"description\": \"The description/synopsis of the book\",  \n  \"pubdate\": \"\",  \n  \"publisher\": \"The Publisher\",  \n  \"identifier\": \"The ISBN\",  \n  \"language\": \"en-US\",  \n  \"rights\": \"Copyright text\",  \n  \"modified_date\": \"\",  \n  \"layout\": \"\",  \n  \"orientation\": \"\",  \n  \"spread\": \"\",  \n  \"direction\": null  \n}      \n+ Book.getToc()在回调函数中获取toc，是一个包含目录结构的数组对象。  \nBook.getToc().then(function(toc){  \n    console.log(toc);  \n});  \n+ Book.generatePagination()进行分页，可选参数为页面大小：   \nbook.generatePagination().then(function(toc){    \n    console.log(\"Pagination generated\");  \n});  \nbook.generatePagination(pageWidth, pageHeight).then(function(toc){  \n    console.log(\"Pagination generated\");  \n});    \n\n## 响应的事件：\n+ book:ready \n+ book:stored\n+ book:online\n+ book:offline\n+ book:linkClicked\n+ book.on('book:linkClicked', function(href) {  \n    console.log(href);  \n});  \n+ book:pageChanged  \n{   \n  anchorPage: 2  \n  percentage: 0.5  \n  pageRange: [1, 2, 3]  \n}  \n+ book.on('book:pageChanged', function(location){  \n    console.log(location.anchorPage, location.pageRange)  \n});  \n+ renderer:resized\n+ renderer:chapterDisplayed\n+ renderer:chapterUnloaded\n+ renderer:locationChanged  \nbook.on('renderer:locationChanged', function(locationCfi){  \n    console.log(locationCfi)  \n});  \n+ renderer:visibleRangeChanged   \n--- \nposted @ 2017-11-11 15:07 肖兆琦","time":1549025039715}